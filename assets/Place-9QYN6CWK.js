var Q=Object.defineProperty;var $=(l,t,e)=>t in l?Q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var y=(l,t,e)=>($(l,typeof t!="symbol"?t+"":t,e),e);import{R as W,a as u,e as v,g as f,A as V,h as q,N as J,i as tt,j as B,k as R,I as k,l as A,m as et,n as P,_ as it,q as st,o as nt,p as ot,u as ht}from"./main-kYMwcdJP.js";import{m as D,C as L,T as j,h as z,n as rt,o as at,E as U,k as lt,p as pt,q as ct,A as ut}from"./ResizePlugin-fT44w4QI.js";var dt=Object.defineProperty,mt=(l,t,e)=>t in l?dt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,r=(l,t,e)=>(mt(l,typeof t!="symbol"?t+"":t,e),e);class w{constructor(t){r(this,"parent"),r(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var gt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Z={exports:{}};(function(l,t){(function(){var e,s;s=function(i){return l.exports=i},e={linear:function(i,n,o,h){return o*i/h+n},easeInQuad:function(i,n,o,h){return o*(i/=h)*i+n},easeOutQuad:function(i,n,o,h){return-o*(i/=h)*(i-2)+n},easeInOutQuad:function(i,n,o,h){return(i/=h/2)<1?o/2*i*i+n:-o/2*(--i*(i-2)-1)+n},easeInCubic:function(i,n,o,h){return o*(i/=h)*i*i+n},easeOutCubic:function(i,n,o,h){return o*((i=i/h-1)*i*i+1)+n},easeInOutCubic:function(i,n,o,h){return(i/=h/2)<1?o/2*i*i*i+n:o/2*((i-=2)*i*i+2)+n},easeInQuart:function(i,n,o,h){return o*(i/=h)*i*i*i+n},easeOutQuart:function(i,n,o,h){return-o*((i=i/h-1)*i*i*i-1)+n},easeInOutQuart:function(i,n,o,h){return(i/=h/2)<1?o/2*i*i*i*i+n:-o/2*((i-=2)*i*i*i-2)+n},easeInQuint:function(i,n,o,h){return o*(i/=h)*i*i*i*i+n},easeOutQuint:function(i,n,o,h){return o*((i=i/h-1)*i*i*i*i+1)+n},easeInOutQuint:function(i,n,o,h){return(i/=h/2)<1?o/2*i*i*i*i*i+n:o/2*((i-=2)*i*i*i*i+2)+n},easeInSine:function(i,n,o,h){return-o*Math.cos(i/h*(Math.PI/2))+o+n},easeOutSine:function(i,n,o,h){return o*Math.sin(i/h*(Math.PI/2))+n},easeInOutSine:function(i,n,o,h){return-o/2*(Math.cos(Math.PI*i/h)-1)+n},easeInExpo:function(i,n,o,h){return i===0?n:o*Math.pow(2,10*(i/h-1))+n},easeOutExpo:function(i,n,o,h){return i===h?n+o:o*(-Math.pow(2,-10*i/h)+1)+n},easeInOutExpo:function(i,n,o,h){return(i/=h/2)<1?o/2*Math.pow(2,10*(i-1))+n:o/2*(-Math.pow(2,-10*--i)+2)+n},easeInCirc:function(i,n,o,h){return-o*(Math.sqrt(1-(i/=h)*i)-1)+n},easeOutCirc:function(i,n,o,h){return o*Math.sqrt(1-(i=i/h-1)*i)+n},easeInOutCirc:function(i,n,o,h){return(i/=h/2)<1?-o/2*(Math.sqrt(1-i*i)-1)+n:o/2*(Math.sqrt(1-(i-=2)*i)+1)+n},easeInElastic:function(i,n,o,h){var a,p,c;return c=1.70158,p=0,a=o,i===0||(i/=h),p||(p=h*.3),a<Math.abs(o)?(a=o,c=p/4):c=p/(2*Math.PI)*Math.asin(o/a),-(a*Math.pow(2,10*(i-=1))*Math.sin((i*h-c)*(2*Math.PI)/p))+n},easeOutElastic:function(i,n,o,h){var a,p,c;return c=1.70158,p=0,a=o,i===0||(i/=h),p||(p=h*.3),a<Math.abs(o)?(a=o,c=p/4):c=p/(2*Math.PI)*Math.asin(o/a),a*Math.pow(2,-10*i)*Math.sin((i*h-c)*(2*Math.PI)/p)+o+n},easeInOutElastic:function(i,n,o,h){var a,p,c;return c=1.70158,p=0,a=o,i===0||(i/=h/2),p||(p=h*(.3*1.5)),a<Math.abs(o)?(a=o,c=p/4):c=p/(2*Math.PI)*Math.asin(o/a),i<1?-.5*(a*Math.pow(2,10*(i-=1))*Math.sin((i*h-c)*(2*Math.PI)/p))+n:a*Math.pow(2,-10*(i-=1))*Math.sin((i*h-c)*(2*Math.PI)/p)*.5+o+n},easeInBack:function(i,n,o,h,a){return a===void 0&&(a=1.70158),o*(i/=h)*i*((a+1)*i-a)+n},easeOutBack:function(i,n,o,h,a){return a===void 0&&(a=1.70158),o*((i=i/h-1)*i*((a+1)*i+a)+1)+n},easeInOutBack:function(i,n,o,h,a){return a===void 0&&(a=1.70158),(i/=h/2)<1?o/2*(i*i*(((a*=1.525)+1)*i-a))+n:o/2*((i-=2)*i*(((a*=1.525)+1)*i+a)+2)+n},easeInBounce:function(i,n,o,h){var a;return a=e.easeOutBounce(h-i,0,o,h),o-a+n},easeOutBounce:function(i,n,o,h){return(i/=h)<1/2.75?o*(7.5625*i*i)+n:i<2/2.75?o*(7.5625*(i-=1.5/2.75)*i+.75)+n:i<2.5/2.75?o*(7.5625*(i-=2.25/2.75)*i+.9375)+n:o*(7.5625*(i-=2.625/2.75)*i+.984375)+n},easeInOutBounce:function(i,n,o,h){var a;return i<h/2?(a=e.easeInBounce(i*2,0,o,h),a*.5+n):(a=e.easeOutBounce(i*2-h,0,o,h),a*.5+o*.5+n)}},s(e)}).call(gt)})(Z);const F=Z.exports;function H(l,t){if(l){if(typeof l=="function")return l;if(typeof l=="string")return F[l]}else return F[t]}const vt={removeOnInterrupt:!1,ease:"linear",time:1e3};class yt extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"startX"),r(this,"startY"),r(this,"deltaX"),r(this,"deltaY"),r(this,"keepCenter"),r(this,"startWidth",null),r(this,"startHeight",null),r(this,"deltaWidth",null),r(this,"deltaHeight",null),r(this,"width",null),r(this,"height",null),r(this,"time",0),this.options=Object.assign({},vt,e),this.options.ease=H(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new u(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const s=this.parent.width,i=this.parent.height;this.complete(),(s!==this.parent.width||i!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const s=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const i=this.startWidth,n=this.deltaWidth;this.parent.fitWidth(i+n*s,this.keepCenter,this.height===null)}if(this.height!==null){const i=this.startHeight,n=this.deltaHeight;this.parent.fitHeight(i+n*s,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const i=this.startX,n=this.startY,o=this.deltaX,h=this.deltaY,a=new u(this.parent.x,this.parent.y);this.parent.moveCenter(i+o*s,n+h*s),this.parent.emit("moved",{viewport:this.parent,original:a,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const ft={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class wt extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"left"),r(this,"top"),r(this,"right"),r(this,"bottom"),r(this,"underflowX"),r(this,"underflowY"),r(this,"ease"),r(this,"toX"),r(this,"toY"),this.options=Object.assign({},ft,e),this.ease=H(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const s=this.options.underflow.toLowerCase();s==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=s.indexOf("left")!==-1?-1:s.indexOf("right")!==-1?1:0,this.underflowY=s.indexOf("top")!==-1?-1:s.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,s=typeof t.y>"u"?0:t.y,i=typeof t.width>"u"?this.parent.worldWidth:t.width,n=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>i,top:this.parent.top<s,bottom:this.parent.bottom>n,topLeft:new u(e*this.parent.scale.x,s*this.parent.scale.y),bottomRight:new u(i*this.parent.scale.x-this.parent.screenWidth,n*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new u(0,0),bottomRight:new u(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let s,i=this.parent.plugins.get("decelerate",!0);i&&(i.x||i.y)&&(i.x&&i.percentChangeX===((t=i.options)==null?void 0:t.friction)||i.y&&i.percentChangeY===((e=i.options)==null?void 0:e.friction))&&(s=this.oob(),(s.left&&this.left||s.right&&this.right)&&(i.percentChangeX=this.options.friction),(s.top&&this.top||s.bottom&&this.bottom)&&(i.percentChangeY=this.options.friction));const n=this.parent.plugins.get("drag",!0)||{},o=this.parent.plugins.get("pinch",!0)||{};if(i=i||{},!(n!=null&&n.active)&&!(o!=null&&o.active)&&(!this.toX||!this.toY)&&(!i.x||!i.y)){s=s||this.oob();const h=s.topLeft,a=s.bottomRight;if(!this.toX&&!i.x){let p=null;s.left&&this.left?p=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-h.x:s.right&&this.right&&(p=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-a.x),p!==null&&this.parent.x!==p&&(this.toX={time:0,start:this.parent.x,delta:p-this.parent.x,end:p},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!i.y){let p=null;s.top&&this.top?p=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-h.y:s.bottom&&this.bottom&&(p=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-a.y),p!==null&&this.parent.y!==p&&(this.toY={time:0,start:this.parent.y,delta:p-this.parent.y,end:p},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const xt={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class Et extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"last"),r(this,"noUnderflow"),r(this,"underflowX"),r(this,"underflowY"),this.options=Object.assign({},xt,e),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new u(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,s=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,s=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,s=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,e.x=0,s=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,s=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,s=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,s=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,e.y=0,s=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const bt={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class Pt extends w{constructor(t,e={}){super(t),r(this,"options"),this.options=Object.assign({},bt,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&e<this.options.minHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&e>this.options.maxHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const n=this.options.minScale;t.x=typeof n.x>"u"?null:n.x,t.y=typeof n.y>"u"?null:n.y}if(typeof this.options.maxScale=="number")e.x=this.options.maxScale,e.y=this.options.maxScale;else if(this.options.maxScale!==null){const n=this.options.maxScale;e.x=typeof n.x>"u"?null:n.x,e.y=typeof n.y>"u"?null:n.y}let s=this.parent.scale.x,i=this.parent.scale.y;t.x!==null&&s<t.x&&(s=t.x),e.x!==null&&s>e.x&&(s=e.x),t.y!==null&&i<t.y&&(i=t.y),e.y!==null&&i>e.y&&(i=e.y),(s!==this.parent.scale.x||i!==this.parent.scale.y)&&(this.parent.scale.set(s,i),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const Tt={friction:.98,bounce:.8,minSpeed:.01},E=16;class Mt extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"x"),r(this,"y"),r(this,"percentChangeX"),r(this,"percentChangeY"),r(this,"saved"),r(this,"timeSinceRelease"),this.options=Object.assign({},Tt,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",s=>this.handleMoved(s))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];t.type==="clamp-x"&&t.original?e.x===t.original.x&&(e.x=this.parent.x):t.type==="clamp-y"&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const s=t-e.time;this.x=(this.parent.x-e.x)/s,this.y=(this.parent.y-e.y)/s,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,s=this.timeSinceRelease,i=this.timeSinceRelease+t;if(this.x){const n=this.percentChangeX,o=Math.log(n);this.parent.x+=this.x*E/o*(Math.pow(n,i/E)-Math.pow(n,s/E)),this.x*=Math.pow(this.percentChangeX,t/E)}if(this.y){const n=this.percentChangeY,o=Math.log(n);this.parent.y+=this.y*E/o*(Math.pow(n,i/E)-Math.pow(n,s/E)),this.y*=Math.pow(this.percentChangeY,t/E)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const Wt={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class kt extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"moved"),r(this,"reverse"),r(this,"xDirection"),r(this,"yDirection"),r(this,"keyIsPressed"),r(this,"mouse"),r(this,"underflowX"),r(this,"underflowY"),r(this,"last"),r(this,"current"),r(this,"windowEventHandlers",[]),this.options=Object.assign({},Wt,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const e=i=>{t.includes(i.code)&&(this.keyIsPressed=!0)},s=i=>{t.includes(i.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",s),this.addWindowEventHandler("keydown",e)}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e=t.pointerType==="mouse",s=this.parent.input.count();return!!((s===1||s>1&&!this.parent.plugins.get("pinch",!0))&&(!e||this.mouse[t.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,s=t.global.y,i=this.parent.input.count();if(i===1||i>1&&!this.parent.plugins.get("pinch",!0)){const n=e-this.last.x,o=s-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(n)||this.yDirection&&this.parent.input.checkThreshold(o)){const h={x:e,y:s};return this.xDirection&&(this.parent.x+=(h.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(h.y-this.last.y)*this.options.factor),this.last=h,this.moved||this.parent.emit("drag-start",{event:t,screen:new u(this.last.x,this.last.y),world:this.parent.toWorld(new u(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(e.length===1){const s=e[0];return s.last&&(this.last={x:s.last.x,y:s.last.y},this.current=s.id),this.moved=!1,!0}else if(this.last&&this.moved){const s=new u(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:s,world:this.parent.toWorld(s),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const s=t.deltaMode?this.options.lineHeight:1,i=[t.deltaX,t.deltaY],[n,o]=this.options.wheelSwapAxes?i.reverse():i;return this.xDirection&&(this.parent.x+=n*s*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=o*s*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const It={speed:0,acceleration:null,radius:null};class St extends w{constructor(t,e,s={}){super(t),r(this,"options"),r(this,"target"),r(this,"velocity"),this.target=e,this.options=Object.assign({},It,s),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let s=this.target.x,i=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius){const h=Math.atan2(this.target.y-e.y,this.target.x-e.x);s=this.target.x-Math.cos(h)*this.options.radius,i=this.target.y-Math.sin(h)*this.options.radius}else return;const n=s-e.x,o=i-e.y;if(n||o)if(this.options.speed)if(this.options.acceleration){const h=Math.atan2(i-e.y,s-e.x),a=Math.sqrt(Math.pow(n,2)+Math.pow(o,2));if(a){const p=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);a>p?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const c=Math.cos(h)*this.velocity.x,m=Math.sin(h)*this.velocity.y,d=Math.abs(c)>Math.abs(n)?s:e.x+c,g=Math.abs(m)>Math.abs(o)?i:e.y+m;this.parent.moveCenter(d,g),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const h=Math.atan2(i-e.y,s-e.x),a=Math.cos(h)*this.options.speed,p=Math.sin(h)*this.options.speed,c=Math.abs(a)>Math.abs(n)?s:e.x+a,m=Math.abs(p)>Math.abs(o)?i:e.y+p;this.parent.moveCenter(c,m),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(s,i),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const Ht={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class Ct extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"reverse"),r(this,"radiusSquared"),r(this,"left"),r(this,"top"),r(this,"right"),r(this,"bottom"),r(this,"horizontal"),r(this,"vertical"),this.options=Object.assign({},Ht,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.pointerType!=="mouse"&&t.pointerId!==1||!this.options.allowButtons&&t.buttons!==0)return!1;const e=t.global.x,s=t.global.y;if(this.radiusSquared){const i=this.parent.toScreen(this.parent.center);if(Math.pow(i.x-e,2)+Math.pow(i.y-s,2)>=this.radiusSquared){const n=Math.atan2(i.y-s,i.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(n))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(n))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(n)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(n)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&s<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&s>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const Ot={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class At extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"active",!1),r(this,"pinching",!1),r(this,"moved",!1),r(this,"lastCenter"),this.options=Object.assign({},Ot,e)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,s=t.global.y,i=this.parent.input.touches;if(i.length>=2){const n=i[0],o=i[1],h=n.last&&o.last?Math.sqrt(Math.pow(o.last.x-n.last.x,2)+Math.pow(o.last.y-n.last.y,2)):null;if(n.id===t.pointerId?n.last={x:e,y:s,data:t}:o.id===t.pointerId&&(o.last={x:e,y:s,data:t}),h){let a;const p=new u(n.last.x+(o.last.x-n.last.x)/2,n.last.y+(o.last.y-n.last.y)/2);this.options.center||(a=this.parent.toLocal(p));let c=Math.sqrt(Math.pow(o.last.x-n.last.x,2)+Math.pow(o.last.y-n.last.y,2));c=c===0?c=1e-10:c;const m=(1-h/c)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=m),this.isAxisY()&&(this.parent.scale.y+=m),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:p});const d=this.parent.plugins.get("clamp-zoom",!0);if(d&&d.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const g=this.parent.toGlobal(a);this.parent.x+=(p.x-g.x)*this.options.factor,this.parent.y+=(p.y-g.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(p.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(p.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=p,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}}const _t={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class Dt extends w{constructor(t,e,s,i={}){super(t),r(this,"options"),r(this,"ease"),r(this,"x"),r(this,"y"),r(this,"percent"),r(this,"snapping"),r(this,"deltaX"),r(this,"deltaY"),r(this,"startX"),r(this,"startY"),this.options=Object.assign({},_t,i),this.ease=H(i.ease,"easeInOutSine"),this.x=e,this.y=s,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const e=this.snapping;e.time+=t;let s,i,n;const o=this.startX,h=this.startY,a=this.deltaX,p=this.deltaY;if(e.time>this.options.time)s=!0,i=o+a,n=h+p;else{const c=this.ease(e.time,0,1,this.options.time);i=o+a*c,n=h+p*c}this.options.topLeft?this.parent.moveCorner(i,n):this.parent.moveCenter(i,n),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),s&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const e=this.options.topLeft?this.parent.corner:this.parent.center;(e.x!==this.x||e.y!==this.y)&&this.snapStart()}}}const zt={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class Xt extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"ease"),r(this,"xScale"),r(this,"yScale"),r(this,"xIndependent"),r(this,"yIndependent"),r(this,"snapping"),this.options=Object.assign({},zt,e),this.ease=H(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,s=this.parent.screenWidth/this.xScale,i=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:s-t,deltaY:i-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const s=this.snapping;if(s.time+=t,s.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const n=this.snapping,o=this.ease(n.time,n.startX,n.deltaX,this.options.time),h=this.ease(n.time,n.startY,n.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/o,this.parent.scale.y=this.parent.screenHeight/h}const i=this.parent.plugins.get("clamp-zoom",!0);i&&i.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}resume(){this.snapping=null,super.resume()}}const Yt={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class Lt extends w{constructor(t,e={}){super(t),r(this,"options"),r(this,"smoothing"),r(this,"smoothingCenter"),r(this,"smoothingCount"),r(this,"keyIsPressed"),this.options=Object.assign({},Yt,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let s;this.options.center||(s=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const i=this.parent.plugins.get("clamp-zoom",!0);if(i&&i.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(s);this.parent.x+=t.x-n.x,this.parent.y+=t.y-n.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),s=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,i=Math.pow(2,(1+this.options.percent)*s);let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const h=this.parent.toGlobal(n);this.parent.x+=e.x-h.x,this.parent.y+=e.y-h.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),s=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,i=Math.pow(2,(1+this.options.percent)*s);if(this.options.smooth){const n={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+n.x)*i-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+n.y)*i-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let n;this.options.center||(n=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const h=this.parent.toGlobal(n);this.parent.x+=e.x-h.x,this.parent.y+=e.y-h.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class Bt{constructor(t){r(this,"viewport"),r(this,"clickedAvailable"),r(this,"isMouseDown"),r(this,"last"),r(this,"wheelFunction"),r(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new W(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.worldVisible)){if(t.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),this.count()===1){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),s=this.viewport.plugins.get("bounce",!0);(!e||!e.isActive())&&(!s||!s.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const s=t.global.x-this.last.x,i=t.global.y-this.last.y;(this.checkThreshold(s)||this.checkThreshold(i))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;t.pointerType==="mouse"&&(this.isMouseDown=!1),t.pointerType!=="mouse"&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new u;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t){this.touches.splice(e,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}const M=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class Rt{constructor(t){r(this,"plugins"),r(this,"list"),r(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,s=M.length){const i=this.plugins[t];i&&i.destroy(),this.plugins[t]=e;const n=M.indexOf(t);n!==-1&&M.splice(n,1),M.splice(s,0,t),this.sort()}get(t,e){var s;return e&&(s=this.plugins[t])!=null&&s.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&((e=this.plugins[t])==null||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;(e=this.plugins[t])==null||e.pause()}resume(t){var e;(e=this.plugins[t])==null||e.resume()}sort(){this.list=[];for(const t of M)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const s of this.list)s.down(t)&&(e=!0);return e}move(t){let e=!1;for(const s of this.viewport.plugins.list)s.move(t)&&(e=!0);return e}up(t){let e=!1;for(const s of this.list)s.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const s of this.list)s.wheel(t)&&(e=!0);return e}}const Ut={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:D.shared,allowPreserveDragOutside:!1};class Ft extends L{constructor(t){super(),r(this,"moving"),r(this,"screenWidth"),r(this,"screenHeight"),r(this,"threshold"),r(this,"input"),r(this,"plugins"),r(this,"zooming"),r(this,"lastViewport"),r(this,"options"),r(this,"_dirty"),r(this,"_forceHitArea"),r(this,"_hitAreaDefault"),r(this,"_pause"),r(this,"tickerFunction"),r(this,"_worldWidth"),r(this,"_worldHeight"),r(this,"_disableOnContextMenu",e=>e.preventDefault()),this.options={...Ut,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new Bt(this),this.plugins=new Rt(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new W(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,s,i){this.screenWidth=t,this.screenHeight=e,typeof s<"u"&&(this._worldWidth=s),typeof i<"u"&&(this._worldHeight=i),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new W(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return arguments.length===2?this.toLocal(new u(t,e)):this.toLocal(t)}toScreen(t,e){return arguments.length===2?this.toGlobal(new u(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new u(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,s;typeof t[0]=="number"?(e=t[0],s=t[1]):(e=t[0].x,s=t[0].y);const i=(this.worldScreenWidth/2-e)*this.scale.x,n=(this.worldScreenHeight/2-s)*this.scale.y;return(this.x!==i||this.y!==n)&&(this.position.set(i,n),this.plugins.reset(),this.dirty=!0),this}get corner(){return new u(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,s;return t.length===1?(e=-t[0].x*this.scale.x,s=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,s=-t[1]*this.scale.y),(e!==this.x||s!==this.y)&&(this.position.set(e,s),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const s=this.screenWidth/t,i=this.screenHeight/e;return Math.min(s,i)}findCover(t,e){const s=this.screenWidth/t,i=this.screenHeight/e;return Math.max(s,i)}fitWidth(t=this.worldWidth,e,s=!0,i){let n;e&&(n=this.center),this.scale.x=this.screenWidth/t,s&&(this.scale.y=this.scale.x);const o=this.plugins.get("clamp-zoom",!0);return!i&&o&&o.clamp(),e&&n&&this.moveCenter(n),this}fitHeight(t=this.worldHeight,e,s=!0,i){let n;e&&(n=this.center),this.scale.y=this.screenHeight/t,s&&(this.scale.x=this.scale.y);const o=this.plugins.get("clamp-zoom",!0);return!i&&o&&o.clamp(),e&&n&&this.moveCenter(n),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,s=this.worldHeight){let i;t&&(i=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/s,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&i&&this.moveCenter(i),this}setZoom(t,e){let s;e&&(s=this.center),this.scale.set(t);const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),e&&s&&this.moveCenter(s),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new Xt(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new u(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new W(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new kt(this,t)),this}clamp(t){return this.plugins.add("clamp",new Et(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new Mt(this,t)),this}bounce(t){return this.plugins.add("bounce",new wt(this,t)),this}pinch(t){return this.plugins.add("pinch",new At(this,t)),this}snap(t,e,s){return this.plugins.add("snap",new Dt(this,t,e,s)),this}follow(t,e){return this.plugins.add("follow",new St(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new Lt(this,t)),this}animate(t){return this.plugins.add("animate",new yt(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new Pt(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new Ct(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,s,i,n){n&&(s>this.worldScreenWidth||i>this.worldScreenHeight)&&(this.fit(!0,s,i),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let o=!1;t<this.left?(this.left=t,o=!0):t+s>this.right&&(this.right=t+s,o=!0),e<this.top?(this.top=e,o=!0):e+i>this.bottom&&(this.bottom=e+i,o=!0),o&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}const K=j.fromBuffer(new Uint8Array([255,255,255,255]),1,1);function N(l,t){return Math.random()*(t-l)+l}class Kt extends L{constructor(){super();y(this,"border");y(this,"background");y(this,"isShaking",!1);this.border=new z(K),this.background=new z(K),this.setup()}startShake(){const e=this.position.clone(),s=Date.now(),i=n=>{if(this.position.x=e.x+N(-v.shakeAmount,v.shakeAmount),this.position.y=e.y+N(-v.shakeAmount,v.shakeAmount),this.isShaking=!0,Date.now()-s>v.time.shake){this.position.x=e.x,this.position.y=e.y,this.isShaking=!1;return}requestAnimationFrame(i)};i()}setup(){this.border.anchor.set(.5,.5),this.background.anchor.set(.5,.5),this.border.scale.set(1+v.hover.outlineSize),this.eventMode="none",this.visible=!1,this.addChild(this.border,this.background)}hover(e){if(this.visible=!0,this.isShaking||(this.position.set(e.x+.5,e.y+.5),this.scale.set(v.hover.scale),f.image.value===null))return;const s=f.image.value.getPixel(e)??new V("#ffffff");this.background.tint=s,this.border.tint=s.getReadableColor()}out(){this.visible=!1,this.scale.set(1)}}class Nt extends z{constructor(){super();y(this,"isZommed",!1);y(this,"isDragged",!1);this.setup()}get image(){if(f.image.value===null)throw new Error("Can't find image");return f.image.value}get size(){if(f.image.value===null)throw new Error("Can't find image");return f.image.value.size}setup(){this.eventMode="static",this.texture=j.fromBuffer(this.image.buffer,this.size.x,this.size.y),this.on("pointermove",this.onPointerMove.bind(this)),this.on("pointerout",this.onPointerOut.bind(this))}async onClick(e){const s=e.event,i=s.getLocalPosition(this),n=new u(Math.floor(i.x),Math.floor(i.y)),o=this.image.getPixel(n);if(!(n.x<0||n.x>this.image.size.x||n.y<0||n.y>this.image.size.y)){if(s.button===0)return q.isEnabled.value?this.emit("will-color-pick",o):this.emit("will-place",n);if(s.button===2)return this.emit("will-color-pick",o)}}onPointerMove(e){const s=e.getLocalPosition(this),{x:i,y:n}=this.image.size;if(s.x<0||s.x>i||s.y<0||s.y>n)return;const o=new u(Math.floor(s.x),Math.floor(s.y));this.emit("hover",o)}onPointerOut(e){this.emit("out")}setSquare(e,s){this.image.setPixel(e,s),this.texture.update(),this.emit("place",{point:e,color:s})}}class Gt extends L{constructor(e,s){super();y(this,"pointer",new Kt);y(this,"place",new Nt);y(this,"pixelInfo",{lastPoint:new u(-1,-1),lastPointTime:0,timeoutId:0});this.viewport=e,this.canvasRef=s,this.setup()}setup(){this.on("cant-place",this.onCantPlace.bind(this)),this.viewport.on("drag-start",this.onDragStart.bind(this)),this.viewport.on("drag-end",this.onDragEnd.bind(this)),this.place.on("will-place",this.onWillPlace.bind(this)),this.place.on("place",this.onPlace.bind(this)),this.place.on("will-color-pick",this.onWillColorPick.bind(this)),this.place.on("hover",this.onHover.bind(this)),this.place.on("out",this.onOut.bind(this)),this.addChild(this.place),this.addChild(this.pointer)}onDragStart(e){this.canvasRef.current&&(this.canvasRef.current.style.cursor="grabbing")}onDragEnd(e){this.canvasRef.current&&(this.canvasRef.current.style.cursor="crosshair"),this.cursor="default"}onCantPlace({reason:e}){J.addNotification({...tt[e],type:"error"}),this.pointer.startShake()}onWillPlace(e){if(B.hasCooldown.peek())return this.emit("cant-place",{reason:"Cooldown"});if(!R.token.peek())return this.emit("cant-place",{reason:"Not logged"});if(k.info.value===null||f.image.value===null)return;if(k.info.value.ended)return this.emit("cant-place",{reason:"Game ended"});if(R.isBanned.value)return this.emit("cant-place",{reason:"Banned"});const s=f.image.value.getPixel(e);this.place.setSquare(e,A.palette.value.selected),et.putPixel({color:A.palette.value.selected.toHex(),x:e.x,y:e.y}).catch(i=>{this.place.setSquare(e,s)})}onPlace(e){this.pointer.hover(e),B.start()}onHover(e){if(P.setCoordinates(e),this.pointer.hover(e),this.pixelInfo.lastPoint.equals(e)){this.pixelInfo.timeoutId===-1&&(P.info.value="loading",this.pixelInfo.timeoutId=window.setTimeout(()=>{P.coordinates.value.x===-1||P.coordinates.value.y===-1||P.fetchInfo()},v.time.pixelInfo));return}window.clearTimeout(this.pixelInfo.timeoutId),this.pixelInfo.timeoutId=-1,this.pixelInfo.lastPoint=e.clone(),P.info.value=null}update(){this.place.texture.update()}onOut(){P.removeCoordinates(),this.pointer.out()}onWillColorPick(e){q.isEnabled.value=!1,A.addAndSelect(e)}}class Vt{constructor(){y(this,"ws")}connect(){this.createWebSocket(),this.setupEventListeners()}createWebSocket(){this.ws=new WebSocket(v.url.api.replace("http","ws")+"/pixels/socket")}setupEventListeners(){this.ws.addEventListener("open",this.onOpen.bind(this)),this.ws.addEventListener("message",this.onMessage.bind(this)),this.ws.addEventListener("close",this.onClose.bind(this)),this.ws.addEventListener("error",this.onError.bind(this))}async onMessage(t){const e=t.data instanceof Blob?await new Response(t.data).json():JSON.parse(t.data);if(f.image.value!==null)switch(e.op){case"PLACE":f.image.value.setPixel(new u(e.x,e.y),new V(e.color)),f.container.value.update();break;case"ENDED":e.value?k.end():k.start();break}}onOpen(t){}reconnect(){f.fetch().then(()=>f.container.value.update()).then(()=>this.connect())}onClose(t){setTimeout(this.reconnect.bind(this),v.time.ws)}onError(t){this.onClose(new CloseEvent("close",t))}}class qt{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(D.system.add(this.tickerUpdate,this,rt.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(D.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const b=new qt;class C{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=C.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new u,this.page=new u,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,s,i,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class I extends C{constructor(){super(...arguments),this.client=new u,this.movement=new u,this.offset=new u,this.global=new u,this.screen=new u}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,s){return t.worldTransform.applyInverse(s||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,s,i,n,o,h,a,p,c,m,d,g,O,ne){throw new Error("Method not implemented.")}}class x extends I{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class T extends I{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}T.DOM_DELTA_PIXEL=0,T.DOM_DELTA_LINE=1,T.DOM_DELTA_PAGE=2;const jt=2048,Zt=new u,_=new u;class Qt{constructor(t){this.dispatch=new at,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((s,i)=>s.priority-i.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let s=0,i=e.length;s<i;s++)e[s].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){b.pauseUpdate=!0;const s=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",i=this[s](this.rootTarget,this.rootTarget.eventMode,Zt.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const s=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,n=s.length-1;i<n;i++)if(t.currentTarget=s[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let i=s.length-2;i>=0;i--)if(t.currentTarget=s[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,s=this._allInteractiveElements){if(s.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const i=Array.isArray(e)?e:[e];for(let n=s.length-1;n>=0;n--)i.forEach(o=>{t.currentTarget=s[n],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let s=0;s<jt&&t!==this.rootTarget;s++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,s,i,n,o=!1){let h=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(b.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let m=c.length-1;m>=0;m--){const d=c[m],g=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,s,i,n,o||n(t,s));if(g){if(g.length>0&&!g[g.length-1].parent)continue;const O=t.isInteractive();(g.length>0||O)&&(O&&this._allInteractiveElements.push(t),g.push(t)),this._hitElements.length===0&&(this._hitElements=g),h=!0}}}const a=this._isInteractive(e),p=t.isInteractive();return a&&p&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:h?this._hitElements:a&&!n(t,s)&&i(t,s)?p?[t]:[]:null}hitTestRecursive(t,e,s,i,n){if(this._interactivePrune(t)||n(t,s))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(b.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let p=a.length-1;p>=0;p--){const c=a[p],m=this.hitTestRecursive(c,this._isInteractive(e)?e:c.eventMode,s,i,n);if(m){if(m.length>0&&!m[m.length-1].parent)continue;const d=t.isInteractive();return(m.length>0||d)&&m.push(t),m}}}const o=this._isInteractive(e),h=t.isInteractive();return o&&i(t,s)?h?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var s;if(t.hitArea&&(t.worldTransform.applyInverse(e,_),!t.hitArea.contains(_.x,_.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!((s=i.containsPoint)!=null&&s.call(i,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var n,o;e=e??t.type;const s=`on${e}`;(o=(n=t.currentTarget)[s])==null||o.call(n,t);const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof x)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const i=e.button===2;this.dispatchEvent(e,i?"rightdown":"mousedown")}const s=this.trackingData(t.pointerId);s.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var a,p;if(!(t instanceof x)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const s=e.pointerType==="mouse"||e.pointerType==="pen",i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.overTargets);if(((a=i.overTargets)==null?void 0:a.length)>0&&n!==e.target){const c=t.type==="mousemove"?"mouseout":"pointerout",m=this.createPointerEvent(t,c,n);if(this.dispatchEvent(m,"pointerout"),s&&this.dispatchEvent(m,"mouseout"),!e.composedPath().includes(n)){const d=this.createPointerEvent(t,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),s&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(m)}if(n!==e.target){const c=t.type==="mousemove"?"mouseover":"pointerover",m=this.clonePointerEvent(e,c);this.dispatchEvent(m,"pointerover"),s&&this.dispatchEvent(m,"mouseover");let d=n==null?void 0:n.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const g=this.clonePointerEvent(e,"pointerenter");for(g.eventPhase=g.AT_TARGET;g.target&&g.target!==n&&g.target!==this.rootTarget.parent;)g.currentTarget=g.target,this.notifyTarget(g),s&&this.notifyTarget(g,"mouseenter"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(m)}const o=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),h&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),h&&o.push("globaltouchmove")),s&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),h&&o.push("globalmousemove"),this.cursor=(p=e.target)==null?void 0:p.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof x)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),s=this.createPointerEvent(t),i=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),i&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=(o=s.target)==null?void 0:o.cursor);const n=this.clonePointerEvent(s,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof x)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const s=t.pointerType==="mouse"||t.pointerType==="pen",i=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(n),s&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(t,"pointerleave",i);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof x)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerup"),s.pointerType==="touch")this.dispatchEvent(s,"touchend");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const h=s.button===2;this.dispatchEvent(s,h?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[t.button]);let o=n;if(n&&!s.composedPath().includes(n)){let h=n;for(;h&&!s.composedPath().includes(h);){if(s.currentTarget=h,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch")this.notifyTarget(s,"touchendoutside");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const a=s.button===2;this.notifyTarget(s,a?"rightupoutside":"mouseupoutside")}h=h.parent}delete i.pressTargetsByButton[t.button],o=h}if(o){const h=this.clonePointerEvent(s,"click");h.target=o,h.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:e});const a=i.clicksByButton[t.button];if(a.target===h.target&&e-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=h.target,a.timeStamp=e,h.detail=a.clickCount,h.pointerType==="mouse"){const p=h.button===2;this.dispatchEvent(h,p?"rightclick":"click")}else h.pointerType==="touch"&&this.dispatchEvent(h,"tap");this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(s)}mapPointerUpOutside(t){if(!(t instanceof x)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),s=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(s){let n=s;for(;n;)i.currentTarget=n,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof T)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let s=1;s<t.length&&t[s].parent===e;s++)e=t[s];return e}createPointerEvent(t,e,s){const i=this.allocateEvent(x);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=s??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],typeof e=="string"&&(i.type=e),i}createWheelEvent(t){const e=this.allocateEvent(T);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const s=this.allocateEvent(x);return s.nativeEvent=t.nativeEvent,s.originalEvent=t.originalEvent,this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.target=t.target,s.path=t.composedPath().slice(),s.type=e??s.type,s}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof x&&e instanceof x&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof I&&e instanceof I&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const s=t.currentTarget._events[e];if(s&&t.currentTarget.isInteractive())if("fn"in s)s.once&&t.currentTarget.removeListener(e,s.fn,void 0,!0),s.fn.call(s.context,t);else for(let i=0,n=s.length;i<n&&!t.propagationImmediatelyStopped;i++)s[i].once&&t.currentTarget.removeListener(e,s[i].fn,void 0,!0),s[i].fn.call(s[i].context,t)}}const $t=1,Jt={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},X=class Y{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Qt(null),b.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new x(null),this.rootWheelEvent=new T(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Y.defaultEventFeatures},{set:(e,s,i)=>(s==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),e[s]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:s}=this.renderer;this.setTargetElement(e),this.resolution=s,Y._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];if(s)switch(typeof s){case"string":e&&(this.domElement.style.cursor=s);break;case"function":s(t);break;case"object":e&&Object.assign(this.domElement.style,s);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let s=0,i=e.length;s<i;s++){const n=e[s],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,b.pointerMoved();const e=this.normalizeToPointerData(t);for(let s=0,i=e.length;s<i;s++){const n=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const s=e!==this.domElement?"outside":"",i=this.normalizeToPointerData(t);for(let n=0,o=i.length;n<o;n++){const h=this.bootstrapEvent(this.rootPointerEvent,i[n]);h.type+=s,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let s=0,i=e.length;s<i;s++){const n=this.bootstrapEvent(this.rootPointerEvent,e[s]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,b.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;b.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;b.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,s){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-i.left)*(this.domElement.width/i.width)*n,t.y=(s-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let s=0,i=t.changedTouches.length;s<i;s++){const n=t.changedTouches[s];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const s=t;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=$t),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Jt[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};X.extension={name:"events",type:[U.RendererSystem,U.CanvasRendererSystem]},X.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let S=X;lt.add(S);function G(l){return l==="dynamic"||l==="static"}const te={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??G(S.defaultEventMode)},set interactive(l){ct("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=l,this.eventMode=l?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??S.defaultEventMode},set eventMode(l){this._internalInteractive=G(l),this._internalEventMode=l},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(l,t,e){const s=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,i=typeof t=="function"?void 0:t;l=s?`${l}capture`:l,t=typeof t=="function"?t:t.handleEvent,this.on(l,t,i)},removeEventListener(l,t,e){const s=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,i=typeof t=="function"?void 0:t;l=s?`${l}capture`:l,t=typeof t=="function"?t:t.handleEvent,this.off(l,t,i)},dispatchEvent(l){if(!(l instanceof C))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return l.defaultPrevented=!1,l.path=null,l.target=this,l.manager.dispatchEvent(l),!l.defaultPrevented}};pt.mixin(te);class ee{constructor(t){y(this,"app");y(this,"viewport");y(this,"canvasRef");y(this,"container");this.canvasRef=t,this.app=new ut({view:t.current,width:window.innerWidth,height:window.innerHeight,backgroundColor:v.defaults.colors.background});const s=new S(this.app.renderer);s.domElement=t.current,this.viewport=new Ft({screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:1e3,events:s,worldHeight:1e3,disableOnContextMenu:!0})}create(t){var i;if(this.container=new Gt(this.viewport,this.canvasRef),t.image.value===null)return;const{size:e}=t.image.value;this.viewport.drag().pinch().wheel().fit(!0,e.x,e.y).zoomPercent(-v.zoom.defaultLevel,!0).clampZoom({maxScale:v.zoom.maxLevel,minWidth:v.zoom.minLevelPx,minHeight:v.zoom.minLevelPx}).moveCenter(new u(e.x/2,e.y/2)).on("clicked",(i=this.container)==null?void 0:i.place.onClick.bind(this.container.place)),this.app.stage.addChild(this.viewport),this.app.render(),this.viewport.addChild(this.container),t.container.value=this.container,new Vt().connect(),this.canvasRef.current.style.cursor="crosshair",window.addEventListener("resize",this.onWindowResize.bind(this))}onWindowResize(){this.app.renderer.resize(window.innerWidth,window.innerHeight),this.viewport.resize(window.innerWidth,window.innerHeight)}}const ie="_canvas_2a5mv_1",se={canvas:ie};function ae(){const l=it(null),t=st(nt);function e(){const s=new ee(l);t.fetch().then(()=>s.create(t))}return ot(e,[]),ht("canvas",{ref:l,className:se.canvas})}export{ae as Place};
